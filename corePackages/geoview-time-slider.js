/*! Package:geoview-time-slider: 0.1.0 - "08b85f0ece8396b32253dc834ab1bd18d26f6183" - 2024-03-27T16:08:12.519Z */
"use strict";(self.webpackChunkgeoview_core=self.webpackChunkgeoview_core||[]).push([[405],{52568:(e,t,n)=>{n.d(t,{b:()=>m});var i=n(80669),r=n(23133),o=n(82734),l=n(59290),a=n(17089),s=n(99317),c=n(73963),u=n(18755),d=n(78330);function p(e,t,n){return t=(0,l.A)(t),(0,o.A)(e,f()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function f(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(f=function(){return!!e})()}var m=function(e){function t(){var e;(0,i.A)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return e=p(this,t,[].concat(r)),(0,c.A)((0,a.A)(e),"value",void 0),(0,c.A)((0,a.A)(e),"footerProps",void 0),e}return(0,s.A)(t,e),(0,r.A)(t,[{key:"onCreateContentProps",value:function(){return{id:"some-id",value:this.value,label:"Some label",content:"<div>Content for Footer plugin on map id ".concat(this.pluginProps.mapId," goes here...</div>")}}},{key:"onAdd",value:function(){var e,t;this.value=null===(e=this.map())||void 0===e?void 0:e.footerBarApi.tabs.length,this.footerProps=this.onCreateContentProps(),null===(t=this.map())||void 0===t||t.footerBarApi.createTab(this.footerProps)}},{key:"onRemove",value:function(){var e;this.value&&(null===(e=this.map())||void 0===e||e.footerBarApi.removeTab(this.footerProps.id))}},{key:"onSelected",value:function(){d.vF.logTraceCore("FOOTER-PLUGIN - onSelected")}}]),t}(u.G)},45093:(e,t,n)=>{var i=n(23133),r=n(80669),o=n(82734),l=n(59290),a=n(17089),s=n(99317),c=n(73963),u=n(15303),d=n(9613),p=n(52568),f=n(40048),m=n(41955),g=n(27994),h=n(3761),v=n(44315),y=n(78330),x=n(98459),w=n(67201),A=n(91808),j=n(30227),b=n(26166),S=n(20027),P=n(32777),D=n(54279),L=n(80038),T=n(9028),k=n(18554),O=n(62423),I=n(17173),C=n(69983),F=n(80678);const E=["className","children","classes","IconComponent","input","inputProps","variant"],R=["root"],V=(0,F.jsx)(O.A,{}),M=b.forwardRef((function(e,t){const n=(0,I.A)({name:"MuiNativeSelect",props:e}),{className:i,children:r,classes:o={},IconComponent:l=k.A,input:a=V,inputProps:s}=n,c=(0,j.A)(n,E),u=(0,T.A)(),d=(0,L.A)({props:n,muiFormControl:u,states:["variant"]}),p=(e=>{const{classes:t}=e;return(0,P.A)({root:["root"]},C.w,t)})((0,A.A)({},n,{classes:o})),f=(0,j.A)(o,R);return(0,F.jsx)(b.Fragment,{children:b.cloneElement(a,(0,A.A)({inputComponent:D.Ay,inputProps:(0,A.A)({children:r,classes:f,IconComponent:l,variant:d.variant,type:void 0},s,a?a.props.inputProps:{}),ref:t},c,{className:(0,S.A)(p.root,a.props.className,i)}))})}));M.muiName="Select";const z=M;var N=function(e){return{panelHeaders:{fontSize:e.palette.geoViewFontSize.lg,fontWeight:"600",marginBottom:"20px"},rightPanelContainer:{border:"2px solid ".concat(e.palette.primary.main),borderRadius:"5px",backgroundColor:e.palette.common.white},rightPanelBtnHolder:{marginTop:"20px",marginBottom:"9px",boxShadow:"0px 12px 9px -13px #E0E0E0"},timeSliderInstructionsTitle:{fontSize:e.palette.geoViewFontSize.lg,fontWeight:"600",lineHeight:"1.5em"},timeSliderInstructionsBody:{fontSize:"1rem"}}};function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){(0,c.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function G(e){var t=window.cgpv,n=e.config,i=e.layerPath,r=e.mapId,o=t.react,l=t.ui,a=o.useState,s=o.useRef,c=o.useEffect,u=l.elements,d=u.Grid,p=u.Slider,h=u.Typography,y=u.Checkbox,A=u.Tooltip,j=u.IconButton,b=u.LockIcon,S=u.LockOpenIcon,P=u.ArrowLeftIcon,D=u.PlayArrowIcon,L=u.PauseIcon,T=u.ArrowRightIcon,k=u.SwitchRightIcon,O=u.SwitchLeftIcon,I=(0,m.A)(),C=N(I),E=a(!1),R=(0,f.A)(E,2),V=R[0],M=R[1],B=s(),G=s(),U=s(),Q=(0,v.Gg)(),q=Q.setTitle,J=Q.setDefaultValue,K=Q.setDescription,Y=Q.setValues,W=Q.setLocked,_=Q.setReversed,X=Q.setDelay,$=Q.setFiltering,Z=(0,v.ky)()[i],ee=Z.title,te=Z.description,ne=Z.name,ie=Z.defaultValue,re=Z.discreteValues,oe=Z.range,le=Z.minAndMax,ae=Z.field,se=Z.fieldAlias,ce=Z.filtering,ue=Z.singleHandle,de=Z.values,pe=Z.delay,fe=Z.locked,me=Z.reversed;c((function(){var e,t=null==n||null===(e=n.sliders)||void 0===e?void 0:e.find((function(e){return e.layerPaths.includes(i)}));void 0===ee&&q(i,(0,g.getLocalizedValue)(null==t?void 0:t.title,r)||""),void 0===te&&K(i,(0,g.getLocalizedValue)(null==t?void 0:t.description,r)||""),void 0===fe&&W(i,void 0!==(null==t?void 0:t.locked)&&(null==t?void 0:t.locked)),void 0===me&&_(i,void 0!==(null==t?void 0:t.reversed)&&(null==t?void 0:t.reversed)),void 0===ie&&J(i,(null==t?void 0:t.defaultValue)||"")}),[]),c((function(){var e,t=null==n||null===(e=n.sliders)||void 0===e?void 0:e.find((function(e){return e.layerPaths.includes(i)}));null!=t&&t.defaultValue&&(Array.isArray(null==t?void 0:t.defaultValue)?Y(i,[new Date(null==t?void 0:t.defaultValue[0]).getTime(),new Date(null==t?void 0:t.defaultValue[1]).getTime()]):oe.includes(null==t?void 0:t.defaultValue)?Y(i,[new Date(null==t?void 0:t.defaultValue).getTime()]):Y(i,[new Date(oe[0]).getTime()]))}),[n,i,oe,$,Y]);var ge,he=oe.map((function(e){return new Date(e).getTime()})),ve=le[1]-le[0],ye=new Date(le[1]).getDate()-new Date(le[0]).getDate(),xe=new Date(le[1]).getFullYear()-new Date(le[0]).getFullYear();0===ye&&ve<864e5?ge="day":0===xe&&(ge="year");var we=[];if(oe.length<4&&re){var Ae=(new Date(oe[oe.length-1]).getTime()-new Date(oe[0]).getTime())/4;we=[le[0],le[0]+Ae,le[0]+2*Ae,le[0]+3*Ae,le[1]]}else we=oe.length<6||ue?he:[le[0],new Date(oe[Math.round(oe.length/4)]).getTime(),new Date(oe[Math.round(oe.length/2)]).getTime(),new Date(oe[Math.round(3*oe.length/4)]).getTime(),le[1]];for(var je=[],be=0;be<we.length;be++)je.push({value:we[be],label:ge?"".concat("day"===ge?new Date(we[be]).toTimeString().split(" ")[0]:new Date(we[be]).toISOString().slice(5,10)):new Date(we[be]).toISOString().slice(0,10)});function Se(){if(ue&&!re){var e,t=he.indexOf(de[0]);e=he[t]===le[0]?he.length-1:t-1,Y(i,[he[e]])}else if(ue){var n=(le[1]-le[0])/20,r=de[0]-n<le[0]?le[1]:de[0]-n;Y(i,[r])}else{var o=(0,f.A)(de,2),l=o[0],a=o[1];if(!U.current){if(a-l>(le[1]-le[0])/5)return U.current=(le[1]-le[0])/5,void Y(i,[a-U.current,a]);U.current=a-l}if(fe&&me){if(l===le[0]&&(l=a),(l-=U.current)<le[0])l=(0,f.A)(le,1)[0]}else if(fe){if((a-=U.current)<l&&(a=l),a===l)a=(0,f.A)(le,2)[1]}else{if(a>G.current&&l===G.current?a=G.current:a-=U.current,a<=le[0])a=(0,f.A)(le,2)[1];if((l=a-U.current)<le[0])l=(0,f.A)(le,1)[0];l<G.current&&a>G.current&&(l=G.current)}Y(i,[l,a])}}function Pe(){if(ue&&!re){var e,t=he.indexOf(de[0]);e=he[t]===le[1]?0:t+1,Y(i,[he[e]])}else if(ue){var n=(le[1]-le[0])/20,r=de[0]+n>le[1]?le[0]:de[0]+n;Y(i,[r])}else{var o=(0,f.A)(de,2),l=o[0],a=o[1];if(!U.current){if(a-l>(le[1]-le[0])/5)return U.current=(le[1]-le[0])/5,void Y(i,[l,l+U.current]);U.current=a-l}if(fe&&me){if((l+=U.current)>=a)l=(0,f.A)(le,1)[0]}else if(fe){if(a===le[1]&&(a=l),(a+=U.current)>le[1])a=(0,f.A)(le,2)[1]}else{if(l<G.current&&a===G.current?l=G.current:l+=U.current,l>=le[1])l=(0,f.A)(le,1)[0];if((a=l+U.current)>le[1])a=(0,f.A)(le,2)[1];a>G.current&&l<G.current&&(a=G.current)}Y(i,[l,a])}}function De(){return me?fe?(0,g.getLocalizedMessage)(r,"timeSlider.slider.unlockRight"):(0,g.getLocalizedMessage)(r,"timeSlider.slider.lockRight"):fe?(0,g.getLocalizedMessage)(r,"timeSlider.slider.unlockLeft"):(0,g.getLocalizedMessage)(r,"timeSlider.slider.lockLeft")}return c((function(){V&&(B.current=me?window.setTimeout((function(){return Se()}),pe):window.setTimeout((function(){return Pe()}),pe))}),[de,ce,me,fe]),c((function(){V&&(me?Se():Pe())}),[V]),(0,F.jsx)(d,{children:(0,F.jsxs)("div",{style:C.rightPanelContainer,children:[(0,F.jsxs)(d,{container:!0,sx:C.rightPanelBtnHolder,children:[(0,F.jsx)(d,{item:!0,xs:9,children:(0,F.jsxs)(h,{component:"div",sx:H(H({},C.panelHeaders),{},{paddingLeft:"20px",paddingTop:"10px"}),children:["".concat(ee||ne),void 0!==ge&&" (".concat("day"===ge?new Date(ie).toLocaleDateString():new Date(ie).getFullYear(),")")]})}),(0,F.jsx)(d,{item:!0,xs:3,children:(0,F.jsx)("div",{style:{textAlign:"right",marginRight:"25px"},children:(0,F.jsx)(A,{title:ce?(0,g.getLocalizedMessage)(r,"timeSlider.slider.disableFilter"):(0,g.getLocalizedMessage)(r,"timeSlider.slider.enableFilter"),placement:"top",enterDelay:1e3,children:(0,F.jsx)(y,{checked:ce,onChange:function(e,t){return $(i,n=t),void(n||(clearInterval(B.current),M(!1)));var n}})})})})]}),(0,F.jsx)(d,{item:!0,xs:12,children:(0,F.jsx)("div",{style:{textAlign:"center",paddingTop:"20px"},children:(0,F.jsx)(p,{sliderId:i,mapId:r,style:{width:"80%",color:"primary"},min:le[0],max:le[1],value:de,valueLabelFormat:function(e){return function(e){return"day"===ge?new Date(e).toTimeString().split(" ")[0].replace(/^0/,""):"year"===ge?new Date(e).toISOString().slice(5,10):new Date(e).toISOString().slice(0,10)}(e)},marks:je,step:re?.1:null,customOnChange:function(e){return function(e){clearTimeout(B.current),M(!1),U.current=void 0,Y(i,e)}(e)}},de[1]?de[1]+de[0]:de[0])})}),(0,F.jsx)(d,{item:!0,xs:12,children:(0,F.jsxs)("div",{style:{textAlign:"center",paddingTop:"20px"},children:[!ue&&(0,F.jsx)(j,{className:"style1","aria-label":De(),tooltip:De(),tooltipPlacement:"top",onClick:function(){return clearTimeout(B.current),void W(i,!fe)},children:fe?(0,F.jsx)(b,{}):(0,F.jsx)(S,{})}),(0,F.jsx)(j,{className:"style1","aria-label":(0,g.getLocalizedMessage)(r,"timeSlider.slider.back"),tooltip:"timeSlider.slider.back",tooltipPlacement:"top",disabled:V||!ce,onClick:function(){return G.current=me?de[1]:de[0],void Se()},children:(0,F.jsx)(P,{})}),(0,F.jsx)(j,{className:"style1","aria-label":V?(0,g.getLocalizedMessage)(r,"timeSlider.slider.pauseAnimation"):(0,g.getLocalizedMessage)(r,"timeSlider.slider.playAnimation"),tooltip:V?"timeSlider.slider.pauseAnimation":"timeSlider.slider.playAnimation",tooltipPlacement:"top",disabled:!ce,onClick:function(){return clearTimeout(B.current),G.current=me?de[1]:de[0],void M(!V)},children:V?(0,F.jsx)(L,{}):(0,F.jsx)(D,{})}),(0,F.jsx)(j,{className:"style1","aria-label":(0,g.getLocalizedMessage)(r,"timeSlider.slider.forward"),tooltip:"timeSlider.slider.forward",tooltipPlacement:"top",disabled:V||!ce,onClick:function(){return e=(0,f.A)(de,1),G.current=e[0],void Pe();var e},children:(0,F.jsx)(T,{})}),(0,F.jsx)(j,{className:"style1","aria-label":(0,g.getLocalizedMessage)(r,"timeSlider.slider.changeDirection"),tooltip:"timeSlider.slider.changeDirection",tooltipPlacement:"top",onClick:function(){return clearTimeout(B.current),_(i,!me),void(V&&(me?Se():Pe()))},children:me?(0,F.jsx)(k,{}):(0,F.jsx)(O,{})}),(0,F.jsxs)(x.A,{sx:{width:"150px"},children:[(0,F.jsx)(w.A,{variant:"standard",children:(0,g.getLocalizedMessage)(r,"timeSlider.slider.timeDelay")}),(0,F.jsxs)(z,{defaultValue:pe,inputProps:{name:"timeDelay",onChange:function(e){return function(e){X(i,e.target.value)}(e)}},children:[(0,F.jsx)("option",{value:500,children:"0.5s"}),(0,F.jsx)("option",{value:750,children:"0.75s"}),(0,F.jsx)("option",{value:1e3,children:"1.0s"}),(0,F.jsx)("option",{value:1500,children:"1.5s"}),(0,F.jsx)("option",{value:2e3,children:"2.0s"}),(0,F.jsx)("option",{value:3e3,children:"3.0s"}),(0,F.jsx)("option",{value:5e3,children:"5.0s"})]})]})]})}),te&&(0,F.jsx)(d,{item:!0,xs:12,children:(0,F.jsx)(h,{component:"div",sx:{px:"20px",py:"5px"},children:te})}),se&&(0,F.jsx)(d,{item:!0,xs:12,children:(0,F.jsx)(h,{component:"div",sx:{px:"20px",py:"5px"},children:"".concat(se," (").concat(ae,")")})})]})})}function U(e){var t=e.mapId,n=e.configObj,i=window.cgpv.react,r=i.useState,o=i.useCallback,l=i.useMemo,a=i.useEffect,s=(0,m.A)(),c=N(s),u=r(),p=(0,f.A)(u,2),x=p[0],w=p[1],A=(0,v.wE)(),j=(0,v.ky)(),b=o((function(e){y.vF.logTraceUseCallback("TIME-SLIDER-PANEL - handleLayerList"),w(e.layerPath)}),[]),S=function(e){return e.filtering?1===e.values.length?new Date(e.values[0]).toLocaleString():"".concat(new Date(e.values[0]).toLocaleString()," - ").concat(new Date(e.values[1]).toLocaleString()):null},P=l((function(){y.vF.logTraceUseMemo("TIME-SLIDER-PANEL - memoLayersList",j);return A.map((function(e){return{layerPath:e,timeSliderLayerInfo:j[e]}})).filter((function(e){return e&&e.timeSliderLayerInfo})).map((function(e){return{layerName:e.timeSliderLayerInfo.name,layerPath:e.layerPath,layerFeatures:S(e.timeSliderLayerInfo),tooltip:(t=e.timeSliderLayerInfo,(0,F.jsxs)(d.Box,{sx:{display:"flex",alignContent:"center","& svg ":{width:"0.75em",height:"0.75em"}},children:[t.name,t.filtering&&": ".concat(S(t))]})),layerStatus:"loaded",queryStatus:"processed"};var t}))}),[j,A]);return a((function(){y.vF.logTraceUseEffect("TIME-SLIDER-PANEL - memoLayersList",P,x),x&&!P.map((function(e){return e.layerPath})).includes(x)&&w("")}),[P,x]),(0,F.jsxs)(h.PE,{selectedLayerPath:x,onLayerListClicked:b,layerList:P,children:[x&&(0,F.jsx)(G,{mapId:t,config:n,layerPath:x},x),!x&&(0,F.jsxs)(d.Paper,{sx:{padding:"2rem"},children:[(0,F.jsx)(d.Typography,{variant:"h3",gutterBottom:!0,sx:c.timeSliderInstructionsTitle,children:(0,g.getLocalizedMessage)(t,"timeSlider.instructions")}),(0,F.jsx)(d.Typography,{component:"p",sx:c.timeSliderInstructionsBody,children:(0,g.getLocalizedMessage)(t,"timeSlider.instructions")})]})]})}const Q=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"GeoView Time Slider Config Schema","type":"object","version":1,"comments":"Configuration for GeoView time slider package.","additionalProperties":false,"properties":{"sliders":{"type":"array","items":{"type":"object","properties":{"title":{"type":"object","properties":{"en":{"type":"string","default":"Time slider title","description":"The English version of the string."},"fr":{"type":"string","default":"Titre du curseur temporel","description":"The French version of the string. "}}},"description":{"type":"object","properties":{"en":{"type":"string","default":"Time slider description","description":"The English version of the string."},"fr":{"type":"string","default":"Description du curseur temporel","description":"The French version of the string. "}}},"locked":{"type":"boolean","default":false,"description":"Lock handle"},"reversed":{"type":"boolean","default":false,"description":"Reverse direction of the slider animation"},"defaultValue":{"type":"string","default":false,"description":"Initial value on slider"}}}},"suportedLanguages":{"type":"array","uniqueItems":true,"items":{"type":"string","enum":["en","fr"]},"default":["en","fr"],"description":"ISO 639-1 code indicating the languages supported by the configuration file.","minItems":1}},"required":["sliders","suportedLanguages"]}'),q=JSON.parse('{"suportedLanguages":["en","fr"],"sliders":[]}');function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){(0,c.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Y(e,t,n){return t=(0,l.A)(t),(0,o.A)(e,W()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function W(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(W=function(){return!!e})()}var _=function(e){function t(){var e;(0,r.A)(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=Y(this,t,[].concat(i)),(0,c.A)((0,a.A)(e),"schema",(function(){return Q})),(0,c.A)((0,a.A)(e),"defaultConfig",(function(){return(0,u.NKs)(q)})),(0,c.A)((0,a.A)(e),"translations",(0,u.NKs)({en:{timeSlider:{title:"Time Slider",panel:{noLayers:"No layers with temporal data"},slider:{unlockRight:"Unlock right handle",unlockLeft:"Unlock left handle",lockRight:"Lock right handle",lockLeft:"Lock left handle",disableFilter:"Disable Filtering",enableFilter:"Enable Filtering",pauseAnimation:"Pause animation",playAnimation:"Play animation",back:"Back",forward:"Forward",changeDirection:"Change animation direction",timeDelay:"Animation time delay"},instructions:"Time Slider Instructions"}},fr:{timeSlider:{title:"Curseur Temporel",panel:{noLayers:"Pas de couches avec des données temporelles"},slider:{unlockRight:"Déverrouiller la poignée droite",unlockLeft:"Déverrouiller la poignée gauche",lockRight:"Verrouiller la poignée droite",lockLeft:"Verrouiller la poignée gauche",disableFilter:"Désactiver le filtrage",enableFilter:"Activer le filtrage",pauseAnimation:"Pause de l'animation",playAnimation:"Jouer l'animation",back:"Retour",forward:"En avant",changeDirection:"Changer la direction de l'animation",timeDelay:"Délai d'animation"},instructions:"Instructions Curseur Temporel"}}})),(0,c.A)((0,a.A)(e),"onCreateContentProps",(function(){return e.configObj.sliders.forEach((function(t){if(t.temporalDimension){var n={field:t.temporalDimension.field,default:t.temporalDimension.default,unitSymbol:t.temporalDimension.unitSymbol,nearestValues:t.temporalDimension.nearestValues,range:u.FHQ.dateUtilities.createRangeOGC(t.temporalDimension.range),singleHandle:t.temporalDimension.singleHandle};u.FHQ.maps[e.pluginProps.mapId].layer.geoviewLayer(t.layerPaths[0]).setTemporalDimension(t.layerPaths[0],n)}if(t.defaultValue){var i=t.layerPaths[0],r=u.FHQ.maps[e.pluginProps.mapId].layer.geoviewLayer(i).layerTemporalDimension[i];u.FHQ.maps[e.pluginProps.mapId].layer.geoviewLayer(i).setTemporalDimension(i,K(K({},r),{},{default:t.defaultValue}))}})),{id:"time-slider",value:e.value,label:"timeSlider.title",icon:(0,F.jsx)(d.TimeSliderIcon,{}),content:(0,F.jsx)(U,{mapId:e.pluginProps.mapId,configObj:e.configObj})}})),e}return(0,s.A)(t,e),(0,i.A)(t)}(p.b);window.geoviewPlugins=window.geoviewPlugins||{},window.geoviewPlugins["time-slider"]=(0,u.KXH)(_)}},e=>{var t;t=45093,e(e.s=t)}]);
//# sourceMappingURL=geoview-time-slider.js.map