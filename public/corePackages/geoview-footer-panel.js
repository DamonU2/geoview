/*! Package:geoview-footer-panel: 0.1.0 - "e5ee04ee9c7d65a37d0110db889f3ef68b28d320" - 2022-12-28T23:41:51.135Z */
"use strict";(self.webpackChunkgeoview_core=self.webpackChunkgeoview_core||[]).push([[435],{1559:(e,t,n)=>{var a=n(7886),r=n(1116),i=n(71120),o=n(33756),s=n(81770),u=n(23078),c=n(3),l=n(21144);const f=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"GeoView Footer Config Schema","type":"object","version":1,"comments":"Configuration for GeoView footer package.","additionalProperties":false,"properties":{"tabs":{"type":"object","description":"Available tabs","properties":{"defaultTabs":{"type":"array","items":{"type":"string","enum":["legend","details","data-grid"]},"minItems":0,"default":["legend","details","data-grid"],"uniqueItems":true,"description":"Defaut tabs of footer panel to use"},"customTabs":{"type":"array","items":{"type":"object","properties":{"defaultTabs":{"type":"string"},"contentHTML":{"type":"string"}}},"minItems":0,"default":[],"uniqueItems":true,"description":"Custom tabs of footer panel to use"}},"additionalProperties":false},"suportedLanguages":{"type":"array","uniqueItems":true,"items":{"type":"string","enum":["en","fr"]},"default":["en","fr"],"description":"ISO 639-1 code indicating the languages supported by the configuration file.","minItems":1},"version":{"type":"string","enum":["1.0"],"description":"The schema version used to validate the configuration file. The schema should enumerate the list of versions accepted by this version of the viewer."}},"required":["suportedLanguages"]}'),d=JSON.parse('{"tabs":{"defaultTabs":["legend","details","data-grid"],"customTabs":[]},"suportedLanguages":["en","fr"]}');var p=n(90755),v=n(45202),g=window;function m(e){var t=e.mapId,n=g.cgpv,a=n.api,r=n.react,i=r.useState,o=r.useEffect,s=i([]),u=(0,p.Z)(s,2),c=u[0],f=u[1],d=i(),m=(0,p.Z)(d,2),y=m[0],E=m[1];return o((function(){return a.event.on(a.eventNames.GET_FEATURE_INFO.ALL_QUERIES_DONE,(function(e){if((0,l.gNW)(e)){var n=e.resultSets,r=[];Object.keys(n).forEach((function(e){var i=(0,l.dIw)(a.map(t).layer.registeredLayers[e].layerName,t),o=n[e];o.length>0&&r.push({layerPath:e,layerName:i,features:o})})),r.length>0?f(r):f([])}else f([])}),t,"".concat(t,"-DetailsAPI")),function(){a.event.off(a.eventNames.GET_FEATURE_INFO.ALL_QUERIES_DONE,t)}}),[]),o((function(){E(a.map(t).details.createDetails(t,c))}),[c]),(0,v.jsx)("div",{children:y})}var y=n(47502),E=window;function h(e){var t=e.mapId,n=E.cgpv,a=n.api,r=n.react,i=r.useState,o=r.useEffect,s=i(),u=(0,p.Z)(s,2),c=u[0],f=u[1],d=i([]),g=(0,p.Z)(d,2),m=g[0],h=g[1];return o((function(){return h(Object.keys(a.map(t).layer.geoviewLayers)),a.event.on(a.eventNames.LAYER.EVENT_REMOVE_LAYER,(function(e){var t;(0,l.UKz)(e)&&(t=e.geoviewLayer.geoviewLayerId,h((function(e){return e.filter((function(e){return e!==t}))})))}),t),a.event.on(a.eventNames.LAYER.EVENT_ADD_LAYER,(function(e){(0,l.riW)(e)&&a.event.on(a.eventNames.LAYER.EVENT_LAYER_ADDED,(function(){var n;n=e.layerConfig.geoviewLayerId,Object.keys(a.map(t).layer.geoviewLayers).includes(n)?h((function(e){return[n].concat((0,y.Z)(e))})):console.error("geoviewLayerId is not in the layers list"),a.event.off(a.eventNames.LAYER.EVENT_LAYER_ADDED,t,e.layerConfig.geoviewLayerId)}),t,e.layerConfig.geoviewLayerId)}),t),function(){a.event.off(a.eventNames.LAYER.EVENT_ADD_LAYER,t),a.event.off(a.eventNames.LAYER.EVENT_REMOVE_LAYER,t)}}),[]),o((function(){f(a.map(t).legend.createLegend({layerIds:m}))}),[m]),(0,v.jsx)("div",{children:c})}function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,u.Z)(e);if(t){var r=(0,u.Z)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,s.Z)(this,n)}}var L=window,T=function(e){(0,o.Z)(n,e);var t=b(n);function n(e,r){var o;return(0,a.Z)(this,n),o=t.call(this,e,r),(0,c.Z)((0,i.Z)(o),"schema",(function(){return f})),(0,c.Z)((0,i.Z)(o),"defaultConfig",(function(){return(0,l.ZQJ)(d)})),(0,c.Z)((0,i.Z)(o),"translations",(0,l.ZQJ)({en:{legend:"Legend",details:"Details",dataGrid:"Data"},fr:{legend:"Légende",details:"Détails",dataGrid:"Données"}})),(0,c.Z)((0,i.Z)(o),"added",(function(){var e=(0,i.Z)(o),t=e.configObj,n=e.pluginProps.mapId,a=L.cgpv;if(a){var r=a.api,s=r.map(n),u=s.displayLanguage,c=s.footerTabs,l=s.map.getTargetElement().parentElement;l&&(l.style.height="calc( 100% - 300px )");var f=null==t?void 0:t.tabs.defaultTabs,d=0;f.includes("legend")&&(c.createFooterTab({value:d,label:o.translations[u].legend,content:function(){return(0,v.jsx)(h,{mapId:n})}}),d++),f.includes("details")&&(c.createFooterTab({value:d,label:o.translations[u].details,content:function(){return(0,v.jsx)(m,{mapId:n})}}),d++),f.includes("data-grid")&&(c.createFooterTab({value:d,label:o.translations[u].dataGrid,content:function(){return r.map(n).dataGrid.createDataGrid({layerId:"esriFeatureLYR4"})}}),d++);for(var p=null==t?void 0:t.tabs.customTabs,g=0;g<p.length;g++){var y=p[g];c.createFooterTab({value:d,label:y.title,content:y.contentHTML}),d++}}})),o.buttonPanel=null,o}return(0,r.Z)(n,[{key:"removed",value:function(){L.cgpv}}]),n}(l.Vw$);L.plugins=L.plugins||{},L.plugins["footer-panel"]=(0,l.RFZ)(T)}},e=>{var t;t=1559,e(e.s=t)}]);
//# sourceMappingURL=geoview-footer-panel.js.map